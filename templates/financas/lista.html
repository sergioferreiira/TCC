{% extends 'base.html' %}
{% block title %}Transações | Finanças{% endblock %}
{% block content %}

<!-- DASHBOARD TOP: filtros + cartões -->
<form method="get" class="row g-2 align-items-end mb-3">
  <div class="col-auto">
    <label class="form-label">Mês</label>
    <input type="month" class="form-control" name="mes" value="{{ mes }}">
  </div>
  <div class="col-auto">
    <label class="form-label">Categoria</label>
    <select class="form-select" name="cat">
      <option value="">Todas</option>
      <option value="fixa" {% if categoria_sel == 'fixa' %}selected{% endif %}>Fixa</option>
      <option value="variavel" {% if categoria_sel == 'variavel' %}selected{% endif %}>Variável</option>
      <option value="lazer" {% if categoria_sel == 'lazer' %}selected{% endif %}>Lazer</option>
      <option value="alimentacao" {% if categoria_sel == 'alimentacao' %}selected{% endif %}>Alimentação</option>
      <option value="outros" {% if categoria_sel == 'outros' %}selected{% endif %}>Outros</option>
    </select>
  </div>
  <div class="col-auto">
    <button class="btn btn-outline-primary" type="submit">Filtrar</button>
  </div>
  <div class="col-auto ms-auto">
    <a href="{% url 'financas:criar' %}" class="btn btn-primary">Nova</a>
  </div>
  <div class="col-auto">
  <a href="{% url 'financas:recorrencias' %}" class="btn btn-outline-secondary">Recorrências</a>
</div>
</form>

<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <div class="text-muted small">Entradas do mês</div>
        <div class="fs-4">R$ {{ entradas_total|default:"0.00" }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <div class="text-muted small">Saídas do mês</div>
        <div class="fs-4">R$ {{ saidas_total|default:"0.00" }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card border-danger">
      <div class="card-body">
        <div class="text-muted small">Saídas pendentes (mês)</div>
        <div class="fs-4 text-danger">R$ {{ saidas_pendentes_total|default:"0.00" }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card border-success">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-muted small">Saldo em conta</div>
            <div class="fs-4 text-success">R$ {{ saldo_em_conta|default:"0.00" }}</div>
          </div>
          <a class="btn btn-sm btn-outline-secondary" href="{% url 'financas:conta' %}">Atualizar</a>
        </div>
        <hr class="my-2">
        <div class="text-muted small">Saldo após débitos</div>
        <div class="fs-6 {% if saldo_pos_debitos < 0 %}text-danger{% else %}text-success{% endif %}">
          R$ {{ saldo_pos_debitos|default:"0.00" }}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- TABELA -->
<table class="table table-striped align-middle">
  <thead>
    <tr>
      <th>Título</th>
      <th>Tipo</th>
      <th>Categoria</th>
      <th class="text-end">Valor (R$)</th>
      <th>Data</th>
      <th>Status</th>
      <th class="text-center">Ações</th>
    </tr>
  </thead>
  <tbody>
    {% for t in itens %}
      <tr>
        <td>{{ t.titulo }}</td>
        <td>
          {% if t.tipo == 'E' %}
            <span class="badge bg-success">Entrada</span>
          {% else %}
            <span class="badge bg-danger">Saída</span>
          {% endif %}
        </td>
        <td>{{ t.get_categoria_display }}</td>
        <td class="text-end">{{ t.valor }}</td>
        <td>{{ t.data|date:'d/m/Y' }}</td>
        <td>
          {% if t.status == 'pago' %}
            <span class="badge bg-secondary">Pago</span>
          {% else %}
            <span class="badge bg-warning text-dark">Pendente</span>
          {% endif %}
        </td>
        <td class="text-center">
          <a href="{% url 'financas:editar' t.pk %}" class="btn btn-sm btn-warning">Editar</a>
          <a href="{% url 'financas:excluir' t.pk %}" class="btn btn-sm btn-outline-danger">Excluir</a>
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="7" class="text-center">Nenhum registro.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
