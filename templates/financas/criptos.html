{% extends "financas/base.html" %}
{% load static %}

{% block title %}Criptomoedas{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-3">Criptomoedas</h2>

  <!-- Controles -->
  <form id="form-criptos" class="row g-2 align-items-end mb-3">
    <div class="col-sm-6 col-md-4">
      <label for="symbols" class="form-label">Símbolos (separados por vírgula)</label>
      <input id="symbols" name="symbols" type="text" class="form-control" value="BTC,ETH" />
    </div>
    <div class="col-sm-4 col-md-2">
      <label for="convert" class="form-label">Moeda</label>
      <input id="convert" name="convert" type="text" class="form-control" value="USD" />
    </div>
    <div class="col-sm-12 col-md-3">
      <button id="btn-checar" type="button" class="btn btn-primary w-100">
        Checar Criptos
      </button>
    </div>
    <div class="col-sm-12 col-md-3">
      <span id="status-msg" class="text-muted small"></span>
    </div>
  </form>

  <!-- Tabela de histórico -->
  <div class="table-responsive">
    <table id="tabela-criptos" class="table table-striped table-bordered align-middle">
      <thead>
        <tr>
          <th>Data</th>
          <th>Símbolo</th>
          <th>Nome</th>
          <th>Preço</th>
          <th>Variação 24h</th>
          <th>Moeda</th>
        </tr>
      </thead>
      <tbody>
        {% for c in historico %}
        <tr>
          <td data-iso="{{ c.data_consulta|date:'c' }}">{{ c.data_consulta|date:"d/m/Y H:i" }}</td>
          <td>{{ c.simbolo }}</td>
          <td>{{ c.nome }}</td>
          <td>{{ c.preco }}</td>
          <td>
            {% if c.variacao_24h >= 0 %}<span class="text-success">+{{ c.variacao_24h }}%</span>
            {% else %}<span class="text-danger">{{ c.variacao_24h }}%</span>
            {% endif %}
          </td>
          <td>{{ c.moeda_fiat }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="6" class="text-center text-muted">Sem histórico ainda. Clique em "Checar Criptos".</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script src="{% static 'js/criptos.js' %}"></script>
{% endblock %}
